STAGE=100000;INT=0x100000000;M=0x7FFFFFFF;result=0;cnt=0;function slime(a)return a%3 end;AL_last=0;AL_magic=0x61C88647;AL_guess=0;function alpaca(a)if AL_last and(result+1)%3~=a then AL_guess=INT*2-(0x42000000+AL_magic*2)end;if AL_guess>AL_magic then AL_guess=AL_guess-AL_magic;AL_last=1;return(a+result+1)%3 else AL_guess=INT+AL_guess-AL_magic;AL_last=0;return(a+result+2)%3 end end;NZ_C=48271;NZ_save={}NZ_size=7;NZ_stage=8000;NZ_now=0;NZ_x={}NZ_coeff={48271,665722,560989,353062,248479,232463,64536}NZ_lvl={1,282,2048,2718,3840,4763,7426}function check_seed(a)NZ_now=a;for b=2,NZ_stage-1 do if NZ_now%3~=NZ_save[b]then return false end;NZ_now=NZ_C*NZ_now%M end;return true end;function nozomi(a)remain=cnt%STAGE;if remain==1001 then NZ_save={}return 0 elseif remain<1001+NZ_stage then table.insert(NZ_save,a)return 0 elseif remain==1001+NZ_stage then table.insert(NZ_save,a)for c=1,NZ_size do diff=(NZ_save[2+NZ_lvl[c]]-NZ_coeff[c]*NZ_save[2])%3;if diff==0 then NZ_x[c]=0 elseif diff==2 then NZ_x[c]=1 else NZ_x[c]=2 end end;seed=0;while seed==0 do while true do bmin=0;smax=M;for c=1,NZ_size do a=NZ_x[c]tmin=(M*a+NZ_coeff[c]-1)//NZ_coeff[c]tmax=M*(a+1)//NZ_coeff[c]bmin=math.max(bmin,tmin)smax=math.min(smax,tmax)end;if bmin<=smax then break end;for c=1,NZ_size do tmax=M*(NZ_x[c]+1)//NZ_coeff[c]while tmax<bmin do NZ_x[c]=NZ_x[c]+3;tmax=M*(NZ_x[c]+1)//NZ_coeff[c]end end end;bmin=bmin//3*3+NZ_save[2]for d=bmin,smax,3 do now=check_seed(d)if check_seed(d)then seed=d;print('seed: '..seed)break end end;for c=1,NZ_size do tmax=M*(NZ_x[c]+1)//NZ_coeff[c]if tmax<=smax then NZ_x[c]=NZ_x[c]+3 end end end end;NZ_now=NZ_now*NZ_C%M;return(NZ_now+2)%3 end;sl_win=0;al_win=0;function play(a)cnt=cnt+1;remain=cnt%STAGE;if remain==1 then sl_win=0;al_win=0 end;if remain<=500 then if(result+1)%3==a then sl_win=sl_win+1 end;result=slime(a)elseif remain<=1000 then if(result+1)%3==a then al_win=al_win+1 end;result=alpaca(a)else if sl_win>400 then result=slime(a)elseif al_win>400 then result=alpaca(a)else result=nozomi(a)end end;return result end
-- EOF
